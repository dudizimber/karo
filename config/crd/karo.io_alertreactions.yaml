---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: alertreactions.karo.io
spec:
  group: karo.io
  names:
    kind: AlertReaction
    listKind: AlertReactionList
    plural: alertreactions
    singular: alertreaction
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.alertName
      name: Alert Name
      type: string
    - jsonPath: .spec.actions[*].name | length
      name: Actions
      type: integer
    - jsonPath: .status.lastTriggered
      name: Last Triggered
      type: date
    - jsonPath: .status.triggerCount
      name: Trigger Count
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: AlertReaction is the Schema for the alertreactions API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AlertReactionSpec defines the desired state of AlertReaction
            properties:
              actions:
                description: Actions defines the list of actions to perform when the
                  alert is received
                items:
                  description: Action defines a single action to perform when an alert
                    is received
                  properties:
                    args:
                      description: Args for the command (optional)
                      items:
                        type: string
                      type: array
                    command:
                      description: |-
                        Command to execute in the container (optional)
                        If not specified, the image's default entrypoint/command will be used
                      items:
                        type: string
                      type: array
                    env:
                      description: Environment variables for the job (optional)
                      items:
                        description: EnvVar represents an environment variable present
                          in a Container.
                        properties:
                          name:
                            description: Name of the environment variable
                            type: string
                          value:
                            description: Value of the environment variable
                            type: string
                          valueFrom:
                            description: Source for the environment variable's value
                            properties:
                              alertRef:
                                description: Selects a field of the alert
                                properties:
                                  fieldPath:
                                    description: Path to the field in the alert (e.g.,
                                      "labels.instance", "annotations.summary")
                                    type: string
                                required:
                                - fieldPath
                                type: object
                              configMapKeyRef:
                                description: Selects a key of a ConfigMap
                                properties:
                                  key:
                                    description: Key to select from the ConfigMap
                                    type: string
                                  name:
                                    description: Name of the ConfigMap
                                    type: string
                                  optional:
                                    description: Specify whether the ConfigMap or
                                      its key must be defined
                                    type: boolean
                                required:
                                - key
                                - name
                                type: object
                              secretKeyRef:
                                description: Selects a key of a secret in the pod's
                                  namespace
                                properties:
                                  key:
                                    description: Key to select from the Secret
                                    type: string
                                  name:
                                    description: Name of the Secret
                                    type: string
                                  optional:
                                    description: Specify whether the Secret or its
                                      key must be defined
                                    type: boolean
                                required:
                                - key
                                - name
                                type: object
                            type: object
                        required:
                        - name
                        type: object
                      type: array
                    image:
                      description: Image to use for the job
                      type: string
                    name:
                      description: Name of the action
                      type: string
                    resources:
                      description: Resources for the job (optional)
                      properties:
                        limits:
                          additionalProperties:
                            type: string
                          description: Limits describes the maximum amount of compute
                            resources allowed
                          type: object
                        requests:
                          additionalProperties:
                            type: string
                          description: Requests describes the minimum amount of compute
                            resources required
                          type: object
                      type: object
                    serviceAccount:
                      description: |-
                        ServiceAccount specifies the service account to use for the job created by this action
                        If not specified, the default service account will be used
                      type: string
                    volumeMounts:
                      description: |-
                        VolumeMounts specifies the volumes to mount into this action's container
                        The volumes must be defined in the AlertReaction's spec.volumes
                      items:
                        description: VolumeMount describes a mounting of a Volume
                          within a container
                        properties:
                          mountPath:
                            description: Path within the container at which the volume
                              should be mounted
                            type: string
                          name:
                            description: Name must match the name of a volume defined
                              in spec.volumes
                            type: string
                          readOnly:
                            description: Mounted read-only if true, read-write otherwise
                              (false or unspecified)
                            type: boolean
                          subPath:
                            description: SubPath within the volume from which the
                              container's volume should be mounted
                            type: string
                        required:
                        - mountPath
                        - name
                        type: object
                      type: array
                  required:
                  - image
                  - name
                  type: object
                minItems: 1
                type: array
              alertName:
                description: AlertName specifies the Prometheus alert name to react
                  to
                type: string
              matchers:
                description: |-
                  Matchers defines additional conditions that must be met for the alert to trigger this reaction
                  All matchers must match for the reaction to be triggered
                  If no matchers are specified, only the AlertName is used for matching
                items:
                  description: AlertMatcher defines conditions for matching alerts
                    using Prometheus-style operators
                  properties:
                    name:
                      description: |-
                        Name of the label or annotation to match against (e.g., "severity", "instance", "service")
                        For labels, this matches against alert labels directly
                        For annotations, prefix with "annotations." (e.g., "annotations.runbook")
                      type: string
                    operator:
                      allOf:
                      - enum:
                        - =
                        - '!='
                        - =~
                        - '!~'
                      - enum:
                        - =
                        - '!='
                        - =~
                        - '!~'
                      description: |-
                        Operator defines the Prometheus-style matching operator
                        "=" for equality, "!=" for inequality, "=~" for regex match, "!~" for negative regex match
                      type: string
                    value:
                      description: |-
                        Value is the value to match against
                        For regex operators (=~ and !~), this should be a valid regular expression
                      type: string
                  required:
                  - name
                  - operator
                  - value
                  type: object
                type: array
              volumes:
                description: |-
                  Volumes defines volumes that can be mounted by actions in this AlertReaction
                  These volumes will be available to all jobs created by this AlertReaction
                items:
                  description: Volume represents a named volume in a job
                  properties:
                    configMap:
                      description: ConfigMap represents a configMap that should populate
                        this volume
                      properties:
                        defaultMode:
                          description: 'Optional: mode bits to use on created files
                            by default'
                          format: int32
                          type: integer
                        name:
                          description: Name of the ConfigMap
                          type: string
                        optional:
                          description: 'Optional: specify whether the ConfigMap or
                            its keys must be defined'
                          type: boolean
                      required:
                      - name
                      type: object
                    emptyDir:
                      description: EmptyDir represents a temporary directory that
                        shares a job's lifetime
                      properties:
                        medium:
                          description: What type of storage medium should back this
                            directory
                          type: string
                        sizeLimit:
                          description: Total amount of local storage required for
                            this EmptyDir volume
                          type: string
                      type: object
                    hostPath:
                      description: HostPath represents a pre-existing file or directory
                        on the host machine
                      properties:
                        path:
                          description: Path of the directory on the host
                          type: string
                        type:
                          description: Type for HostPath Volume
                          type: string
                      required:
                      - path
                      type: object
                    name:
                      description: Name of the volume
                      type: string
                    persistentVolumeClaim:
                      description: PersistentVolumeClaim represents a PVC that should
                        be mounted
                      properties:
                        claimName:
                          description: ClaimName is the name of a PersistentVolumeClaim
                            in the same namespace
                          type: string
                        readOnly:
                          description: ReadOnly will force the ReadOnly setting in
                            VolumeMounts
                          type: boolean
                      required:
                      - claimName
                      type: object
                    secret:
                      description: Secret represents a secret that should populate
                        this volume
                      properties:
                        defaultMode:
                          description: 'Optional: mode bits to use on created files
                            by default'
                          format: int32
                          type: integer
                        optional:
                          description: 'Optional: specify whether the Secret or its
                            keys must be defined'
                          type: boolean
                        secretName:
                          description: Name of the Secret
                          type: string
                      required:
                      - secretName
                      type: object
                  required:
                  - name
                  type: object
                type: array
            required:
            - actions
            - alertName
            type: object
          status:
            description: AlertReactionStatus defines the observed state of AlertReaction
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the AlertReaction's state
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource.\n---\nThis struct is intended for
                    direct use as an array at the field path .status.conditions.  For
                    example,\n\n\n\ttype FooStatus struct{\n\t    // Represents the
                    observations of a foo's current state.\n\t    // Known .status.conditions.type
                    are: \"Available\", \"Progressing\", and \"Degraded\"\n\t    //
                    +patchMergeKey=type\n\t    // +patchStrategy=merge\n\t    // +listType=map\n\t
                    \   // +listMapKey=type\n\t    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`\n\n\n\t
                    \   // other fields\n\t}"
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: |-
                        type of condition in CamelCase or in foo.example.com/CamelCase.
                        ---
                        Many .condition.type values are consistent across resources like Available, but because arbitrary conditions can be
                        useful (see .node.status.conditions), the ability to deconflict is important.
                        The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastJobsCreated:
                description: LastJobsCreated contains references to the last batch
                  of jobs created
                items:
                  description: JobReference contains a reference to a created job
                  properties:
                    actionName:
                      description: ActionName that created this job
                      type: string
                    createdAt:
                      description: CreatedAt timestamp
                      format: date-time
                      type: string
                    name:
                      description: Name of the job
                      type: string
                    namespace:
                      description: Namespace of the job
                      type: string
                  required:
                  - actionName
                  - createdAt
                  - name
                  - namespace
                  type: object
                type: array
              lastTriggered:
                description: LastTriggered indicates when this AlertReaction was last
                  triggered
                format: date-time
                type: string
              triggerCount:
                description: TriggerCount indicates how many times this AlertReaction
                  has been triggered
                format: int64
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
